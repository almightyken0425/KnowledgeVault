# 5.11. 設定 - 匯率管理 (CurrencyRateScreen)

_(本文件定義「匯率管理」畫面的 UI、流程與邏輯，此為付費功能)_

## 1. 畫面目標 (Screen Objective)

- 提供一個中心化的儀表板，讓使用者可以**查看**並**更新**他們所使用的各個貨幣對的**最新有效匯率**。
- 清楚地向使用者溝通匯率的計算與應用規則。

## 2. UI 佈局與元件 (UI Layout & Components)

- **2.1. 頂部導航列 (Top Navigation Bar):**
    - **左側:** 「返回」按鈕，導航回 `SettingsScreen`。
    - **中間:** 畫面標題，顯示「匯率管理」。

- **2.2. 說明文字區 (Info Text Area):**
    - **UI:** 在「匯率列表」的上方，應有一個清晰的說明區塊。
    - **內容:**
        > 「此處顯示各貨幣對的**最新有效匯率**。當您進行跨幣別轉帳時，系統會自動記錄當下的匯率。所有報表在計算總資產時，將統一採用您在此處設定的最新匯率進行換算。您可以點擊下方的匯率項目來手動更新。」

- **2.3. 匯率列表 (Rate List):**
    - **UI:** 一個列表 (`FlatList`)，**僅顯示**使用者所有使用過的貨幣對及其**最新一筆**的有效匯率。
    - **項目內容 (每筆):**
        - 顯示類似「1 USD = 32.5 TWD」的文字。
        - 顯示該匯率的最後更新日期 (`RateDate`)。
    - **空狀態 (Empty State):** 如果使用者尚未使用任何外幣帳戶，則顯示提示文字，例如「當您新增外幣帳戶或進行跨幣別轉帳時，相關匯率將會顯示於此。」

- **2.4. 新增按鈕 (Add Button):**
    - **UI:** 一個懸浮操作按鈕 (FAB)，圖示為「+」。
    - **邏輯:** 點擊後導航至 `CurrencyRateEditorScreen` (待定義) 的「新增」模式。

## 3. 核心邏輯

- **3.1. 資料載入邏輯:**
    - 畫面載入時，執行以下步驟來取得資料：
        1.  從 `Accounts` 和 `Transfers` 中找出所有使用者曾用過的獨立貨幣對 (例如 `[USD, TWD]`, `[JPY, TWD]`)。
        2.  對於每一個貨幣對 (`CurrencyFromId`, `CurrencyToId`)，在 `CurrencyRates` 表中查找 `RateDate` **最新**的一筆記錄。
        3.  將這些最新的匯率記錄顯示在列表中。

- **3.2. 互動邏輯:**
    - **點擊列表項目:** 導航至 `CurrencyRateEditorScreen` (待定義) 的「編輯」模式，並傳入該貨幣對的 ID。使用者在此畫面**更新**匯率。
    - **更新匯率的行為:** 當使用者在編輯器中儲存一個新匯率時，程式應在 `CurrencyRates` 表中**新增一筆記錄**，而不是修改舊記錄。這確保了 `RateDate` 能夠反映更新的時間，使其成為新的「最新匯率」。

- **3.3. 付費牆檢查 (Paywall Check):**
    - 由於此畫面為付費功能，在從 `SettingsScreen` 導航至此畫面之前，就應檢查 `isPremiumUser` 狀態。若為免費版使用者，則直接導向 `PaywallScreen` (5.15)。

## 4. 狀態管理 (State Management)

- 使用 `useState` 管理從 `CurrencyRates` 讀取並處理過的匯率列表 `latestRates: Rate[]`。

## 5. 導航 (Navigation)

- **進入:** 從 `SettingsScreen` (5.5) 的「匯率管理」項目點擊進入。
- **退出:** 點擊頂部導航列的「返回」按鈕。
- **導出:** 點擊列表項目或新增按鈕，導航至 `CurrencyRateEditorScreen` (待定義)。
