# 分叉類型 Fork Types

## 分叉本質

- **定義:** 區塊鏈在某個時間點產生兩條或多條有效但互相競爭的鏈。
- **根本原因:** 去中心化網路中，節點之間需要時間同步資訊，無法瞬間達成共識。
- **兩大類別:**
  - **暫時性分叉:** 網路自動收斂，最終只剩一條主鏈。
  - **協議分叉:** 規則不相容，形成永久獨立的區塊鏈網路。

---

## 協議分叉 Protocol Fork

### 硬分叉 Hard Fork

#### 定義與特性

- **規則擴張:** 放寬或修改原有協議規則，使新區塊對舊節點變為非法。
- **向下不相容:** 舊節點無法驗證新節點的區塊。
- **永久分裂:** 除非所有節點都升級，否則會形成兩條獨立的鏈。
- **新貨幣誕生:** 分叉後通常產生新的加密貨幣。

#### 觸發情境

- **區塊大小增加:** 原本 1 MB 限制提升至 8 MB。
- **PoW 算法變更:** 從 SHA256 改為 Scrypt 或其他算法。
- **經濟模型調整:** 修改區塊獎勵或總供應量。
- **新功能引入:** 加入原協議不支援的新交易類型或腳本語言。

#### 節點行為

- **舊節點視角:**
  - **驗證失敗:** 新區塊違反已知規則，立刻拒絕。
  - **不轉發:** 不會將新區塊廣播給其他節點。
  - **繼續舊鏈:** 只接受符合原始規則的區塊。
- **新節點視角:**
  - **兩條鏈都接受:** 可以驗證舊規則的區塊，也接受新規則的區塊。
  - **選擇最長鏈:** 通常會跟隨算力最大的分支。

#### 實際案例

- **Bitcoin Cash - BCH:**
  - **時間:** 2017 年 8 月 1 日
  - **變更:** 區塊大小從 1 MB 提升至 8 MB
  - **結果:** 形成獨立貨幣，擁有自己的生態系統與市值
- **Ethereum Classic - ETC:**
  - **時間:** 2016 年 7 月
  - **變更:** 為了逆轉 The DAO 攻擊而修改鏈狀態
  - **爭議:** 部分社群拒絕升級，堅持原鏈不可篡改原則
  - **結果:** 兩條鏈並存，ETH 與 ETC 各自發展

### 軟分叉 Soft Fork

#### 定義與特性

- **規則收緊:** 收緊原有協議規則，使新區塊對舊節點仍然合法。
- **向下相容:** 舊節點可以驗證新區塊，但可能無法理解新功能完整語義。
- **暫時分叉風險:** 如果舊節點挖出不符合新規則的區塊，會被新節點拒絕。
- **算力驅動:** 只要大多數算力支持新規則，舊節點會自然跟隨最長鏈。

#### 觸發情境

- **區塊大小縮減:** 將 1 MB 限制降至 500 KB。
- **新腳本限制:** 禁用某些原本允許的交易腳本操作碼。
- **時間鎖規則:** 加入新的交易時間鎖驗證邏輯。

#### 節點行為

- **舊節點視角:**
  - **區塊有效:** 新區塊符合已知規則，可以驗證並接受。
  - **語義理解有限:** 可能視新型交易為 Anyone-Can-Spend，但仍認為合法。
  - **挖礦風險:** 如果挖出不符合新規則的區塊，會被新節點拒絕，成為孤兒塊。
- **新節點視角:**
  - **嚴格驗證:** 拒絕不符合新規則的所有區塊。
  - **完整功能:** 能解析與使用新引入的交易類型。

#### 實際案例

- **SegWit - Segregated Witness:**
  - **時間:** 2017 年 8 月
  - **變更:** 將見證數據從交易主體中分離，修改區塊容量計算方式
  - **相容性:** 舊節點視 SegWit 交易為合法，但無法驗證見證數據
  - **激活方式:** 透過礦工投票達到 95% 支持率後啟動
- **P2SH - Pay to Script Hash:**
  - **時間:** 2012 年 4 月
  - **變更:** 引入新的腳本類型，允許更複雜的支付條件
  - **相容性:** 舊節點無法解析腳本邏輯，但仍視交易為有效

---

## 分叉對比 Fork Comparison

### 關鍵差異

| 特性           | 硬分叉 Hard Fork         | 軟分叉 Soft Fork           |
| -------------- | ------------------------ | -------------------------- |
| **規則變更**   | 放寬或新增規則           | 收緊現有規則               |
| **向下相容性** | 不相容，舊節點拒絕新區塊 | 相容，舊節點接受新區塊     |
| **網路分裂**   | 永久分裂成兩條鏈         | 暫時分叉，算力驅動收斂     |
| **升級強制性** | 必須升級才能跟隨新鏈     | 可選升級，但建議升級       |
| **貨幣影響**   | 產生新的獨立貨幣         | 同一貨幣，功能擴展         |
| **共識需求**   | 需要全網或大部分算力支持 | 只需大多數算力支持即可激活 |

### 選擇考量

- **硬分叉適用情境:**
  - **重大架構變更:** 無法透過收緊規則實現的功能。
  - **社群分歧:** 對發展方向有根本性不同意見。
  - **緊急修復:** 修補重大安全漏洞，無法向下相容。
- **軟分叉適用情境:**
  - **功能升級:** 加入新功能但不破壞現有生態。
  - **漸進式推進:** 允許舊節點逐步升級，降低分裂風險。
  - **算力共識:** 透過礦工投票達成共識後激活。

---

## 分叉風險與治理 Fork Risks and Governance

### 網路分裂風險

- **算力分散:** 兩條鏈的總算力被稀釋，增加 51% 攻擊風險。
- **生態割裂:** 開發者、礦工、交易所、錢包需選邊站，社群撕裂。
- **市值波動:** 不確定性導致價格劇烈波動，投資者信心受損。
- **重放攻擊:** 如果未實施重放保護，一條鏈上的交易可能在另一條鏈上被重放執行。

### 分叉決策機制

- **開發者提案:** 透過 BIP - Bitcoin Improvement Proposal 等機制提交技術提案。
- **社群討論:** 在論壇、郵件列表、社群媒體進行公開辯論。
- **礦工投票:** 透過在 Coinbase 或區塊版本號中標記支持或反對訊號。
- **用戶選擇:** 最終由用戶決定運行哪個版本的軟體，決定哪條鏈有價值。

### 鏈上治理 vs 鏈外治理

- **鏈上治理:**
  - **機制:** 將投票與決策邏輯直接寫入協議，例如持幣者投票。
  - **優點:** 透明、自動化、可驗證。
  - **缺點:** 可能被大戶操控，缺乏辯論空間。
  - **案例:** Tezos、Decred
- **鏈外治理:**
  - **機制:** 透過社群討論、開發者會議、礦工訊號達成共識。
  - **優點:** 靈活、包容多方意見、允許充分辯論。
  - **缺點:** 過程冗長、可能陷入僵局、難以量化共識。
  - **案例:** Bitcoin、Ethereum

---

## 分叉與網路升級 Forks and Network Upgrades

### 計劃性升級

- **預告機制:** 提前數月公布升級計劃與技術細節。
- **測試網驗證:** 先在測試網路激活新規則，驗證穩定性與相容性。
- **激活條件:** 設定明確的激活時間或區塊高度，或達到算力門檻後自動激活。
- **社群準備:** 給予礦池、交易所、錢包服務商充足時間升級軟體。

### 爭議性分叉

- **社群分裂:** 對變更方向有根本性不同意見，無法達成共識。
- **雙鏈並存:** 兩條鏈各自發展，形成競爭關係。
- **市場決定:** 最終由市場價格、算力分佈、生態發展決定哪條鏈更成功。
- **案例:** Bitcoin vs Bitcoin Cash、Ethereum vs Ethereum Classic

---
