# Git 動態 (2.4): Pull Request - 團隊協作的核心

在 `no3` 的故事線範例中，我們提到了「透過 Pull Request 在 GitHub 上將其合併回 main 分支」。這份文件將專門解釋什麼是 Pull Request (PR)，以及它在團隊協作中扮演了多麼重要的角色。

---

## 什麼是 Pull Request PR

**白話比喻：一份「合併申請書」。**

想像一下，開發者 Dave 在 `feature/login` 這個分支上完成了登入功能。他不能、也不應該直接將他的程式碼合併到 `main` 主線中，因為這可能會引入未經測試的 Bug，或是與團隊的目標不符。

於是，Dave 會在 GitHub 上發起一個 Pull Request。這個動作就像是提交一份申請書，內容是：

> 「大家好，我完成了登入功能，這是我在 `feature/login` 分支上的所有修改。請大家幫忙檢查一下我的程式碼，如果沒問題，再請專案負責人將它合併到 `main` 分支中。」

**PR 的核心目的：在程式碼正式進入主線之前，提供一個討論、審查和測試的平台。**

### Pull Request 的故事線

讓我們用「本地 vs. 雲端」的對比圖示，來看看 PR 的完整流程：

```
本地開發：開發者從同步好的 `main` 分支 (C2) 出發，建立一個新的功能分支 `feature/login`，並新增了數個存檔點 (C3, C4) 來完成功能。

   您的電腦 (Local):
   C1 -- C2 (main)
         \
          C3 -- C4 (feature/login)

   GitHub (Remote): (尚未收到任何更新，保持原樣)
   C1 -- C2 (main)


推送分支並發起 PR：開發者將 `feature/login` 分支推送到遠端，並在 GitHub 上發起一個從 `feature/login` 到 `main` 的 Pull Request。
   (此時，`main` 分支可能因為其他修改而有了新的進度 C5)

   您的電腦 (Local): (狀態不變)
   C1 -- C2 (main)
         \
          C3 -- C4 (feature/login)

   GitHub (Remote): (接收到 feature/login 分支，且 main 分支也前進了)
   C1 -- C2 -- C5 (main)
         \
          C3 -- C4 (feature/login)


在 GitHub 上合併 PR：經過團隊審查並批准後，專案負責人在 GitHub 網站上點擊「Merge」按鈕。

   您的電腦 (Local): (尚未同步，不知道遠端發生了合併)
   C1 -- C2 (main)
         \
          C3 -- C4 (feature/login)

   GitHub (Remote): (main 故事線產生了新的合併節點 C6)
   C1 -- C2 -- C5 ------ C6 (main)
         \             /
          C3 -------- C4 (feature/login)


同步回本地：最後，所有團隊成員執行 `git pull`，將遠端 `main` 分支的最新進度 (包含合併後的 C6) 同步回自己的電腦，以準備下一次的開發。
```

---

## 處理 PR 中的合併衝突 Merge Conflicts

這與 `no3` 中提到的「推送被拒絕 (Push Rejection)」有些類似，但發生的情境不同。推送被拒絕是您嘗試直接推送到一個過時的共享分支；而**合併衝突**則是在您發起 Pull Request 後，GitHub 發現您的功能分支與目標分支 (`main`) 之間存在無法自動合併的程式碼。

在團隊協作中，一個常見的情況是：當您發起 PR 時，GitHub 提示「**This branch has conflicts that must be resolved**」，並且「Merge」按鈕變為灰色不可點擊。

### 為什麼會發生衝突？

這通常發生在：您從 `main` 分支出去開發新功能的期間，有其他同事的程式碼已經先一步合併回 `main` 分支，並且他修改的檔案與位置，和您修改的**完全相同**。

```
   C1 -- C2 -- C5 (main)
         \
          C3 -- C4 (feature/login)

   說明：
   - 當 feature/login (包含 C4) 想要合併回 main 時，Git 發現 main 已經有了新的進度 C5。
   - 如果 C4 和 C5 修改了同一個檔案的同一行，衝突就發生了。
```

當您試圖透過 PR 將您的分支合併回 `main` 時，Git 無法決定應該保留誰的修改，因此它會將這個決定權交還給您。

### 如何解決衝突？ - 由 PR 作者負責

解決衝突的責任通常落在 PR 的作者身上。您需要將 `main` 分支的最新進度拉回您的功能分支，在**本地電腦**解決衝突，然後再將解決後的結果推送到遠端。

#### 解決流程

```
衝突發生時的狀態：
   (您的 PR 試圖將 C4 合併到 main，但 C5 已經存在，且與 C4 衝突)

   GitHub (Remote):
   C1 -- C2 -- C5 (main)
         \
          C3 -- C4 (feature/login)


在本地切換到您的功能分支，並將最新的 `main` 分支拉下來：
   ```bash
   # 確保您在自己的功能分支上
   git checkout feature/login
   # 將遠端的 main 分支合併到您當前的分支
   git merge origin/main
   ```
   執行後，Git 會在您的本地電腦上報告檔案衝突。


在本地解決衝突：
   - 打開有衝突的檔案，您會看到類似 `<<<<<<< HEAD`、`=======`、`>>>>>>>` 的標記。
   - 手動編輯檔案，刪除這些標記，並保留您最終想要的版本。
   - 儲存檔案後，執行 `git add <衝突檔案>` 將解決後的檔案加入暫存區。
   - 執行 `git commit` 來建立一個新的「解決衝突」的存檔點 (C7)。


將解決衝突後的結果推送到遠端：
   ```bash
   git push origin feature/login
   ```
   推送成功後，GitHub 會偵測到衝突已解決，PR 頁面上的「Merge」按鈕會重新變為可用。
```

---

## 在 Pull Request 中的角色與協作

Pull Request 不僅僅是工程師之間互相檢查程式碼的地方，它更是團隊成員（如產品經理、設計師和開發者）之間溝通的橋樑。在 PR 中，不同角色可以從各自的專業角度進行協作。

### 如何參與一個 PR？

- **收到通知**: 當開發者發起一個 PR 並指定您為「審查者 (Reviewer)」時，您會收到 GitHub 的通知。
- **進入 PR 頁面**: 點擊通知連結，進入 PR 的專屬頁面。

### 您需要關注什麼？

-   **標題與描述 (Title & Description)**:
    -   一個好的 PR 會有清晰的標題（例如：「實作使用者登入功能」）和詳細的描述，說明這次變更的目的、解決了什麼問題，甚至可能附上相關的設計圖或需求文件連結。

-   **查看檔案變更 (`Files changed` 標籤頁)**:
    -   這是最重要的部分。點擊「Files changed」，您可以看到這次「合併申請」中所有檔案的具體變更。
    -   **綠色背景**代表新增的內容，**紅色背景**代表刪除的內容。
    -   即使您不懂程式碼，也可以從檔名、文字內容的變更來判斷這次修改是否符合您的預期。例如，您可以看到按鈕上的文字是否正確，或是一個新的畫面檔案是否被加入。

-   **參與討論與審查 (`Conversation` 標籤頁)**:
    -   **留下評論**: 如果您對某個變更有疑問，可以直接在「Files changed」頁面的特定程式碼行數旁點擊「+」號，留下您的評論。例如：「這個按鈕的文字應該是『註冊』而不是『登記』。」
    -   **批准變更**: 當您確認這次的修改符合團隊目標時，可以點擊「Review changes」按鈕，選擇「**Approve**」並提交。這個動作代表審查者從其專業角度（例如產品、設計或技術）認可了這次的變更。

### 總結

學會閱讀和參與 Pull Request，是確保開發成果符合團隊目標的最佳途徑。它將抽象的需求文字，轉化為具體的程式碼變更，讓團隊的溝通建立在一個共同的、可視化的基礎之上。

---
