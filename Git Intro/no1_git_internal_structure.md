# Git 內部結構

這份文件將拆解 Git 在您本機上的靜態元素。我們將使用倉庫的比喻來理解這些零件。

### 切角一：Git 的靜態元素 - 不含時間與功能

我們來盤點一下 Git 世界中所有的名詞和元素。

#### 儲存庫 Repository

- **比喻：** 整個倉庫園區。
    
- **描述：** 這是最大的外框。它包含了您的工作目錄，也就是您看到的檔案，和 .git 資料夾，即倉庫的管理中心與儲存區。
    
- **類型：**
    
    - **本機儲存庫 Local Repo:** 您電腦上的，有 .git 也有工作目錄。
        
    - **遠端裸儲存庫 Remote Bare Repo:** GitHub 上的，**只有** .git 的內容，沒有工作目錄。
        

#### .git 資料夾

- **比喻：** 倉庫管理與倉儲中心。
    
- **描述：** 這是儲存庫的核心。它包含了以下所有元素。
    

#### 物件資料庫 Object Database

- **比喻：** 倉庫儲藏區，位於 .git/objects。
    
- **描述：** 存放所有貨物的地方。所有貨物都用其內容的雜湊值當作 ID。
    
- **主要貨物類型：**
    
    - **Blob - 檔案內容:** 最小的貨物。它只儲存您檔案的內容，不包含檔名或路徑。例如：一箱蘋果。
        
    - **Tree - 目錄快照:** 貨物清單。它定義了一個資料夾的結構。
        
        - **內容就像：**
            
            - `App.js` 檔案的內容是 Blob `9a3b...`
                
            - `css/` 資料夾的清單是 Tree `5c8f...`
                
    - **Commit - 提交快照:** 棧板。它將所有東西串起來。
        
        - **內容如上所述：** 這張棧板用的是 `Tree f4c1e2...` 這張清單，而它前一張棧板是 `parent abc123...`。
            

#### 參考 References / Refs

- **比喻：** 倉庫管理辦公室裡的指標看板，大部分在 .git/refs。
    
- **描述：** 這些是輕量級的指標，指向特定的 Commit 物件。
    
- **主要指標類型：**
    
    - **分支 Branches:** 例如 .git/refs/heads/main。可移動的白板，指向最新的進度。
        
    - **標籤 Tags:** 例如 .git/refs/tags/v1.0。固定不動的奇異筆標籤，錨定在某個重要歷史點。
        
    - **HEAD - 當前位置:** .git/HEAD 檔案。您或倉管員的指標，決定您目前正在看哪一塊白板，也就是哪個分支。
        

#### 暫存區 Staging Area / Index

- **比喻：** 倉庫出貨暫存平台。
    
- **描述：** 這是一個單一檔案，位於 .git/index。它是一個清單，精確記錄了您下一次 commit 準備要打包的內容。
    
- **位置：** 它位於工作目錄和物件資料庫之間，扮演緩衝區的角色。
    

#### 工作目錄 Working Directory

- **比喻：** 倉庫管理與倉儲中心。
    
- **描述：** 這是儲存庫的核心。它包含了以下所有元素。
    

#### 物件資料庫 Object Database

- **比喻：** 倉庫儲藏區，位於 .git/objects。
    
- **描述：** 存放所有貨物的地方。所有貨物都用其內容的雜湊值當作 ID。
    

#### 靜態總結

| 元素 | 比喻 | 實際位置本機 | 作用 |
|---|---|---|---|
| **工作目錄** | 工廠 | 專案資料夾，非 .git | 讓您實際編輯檔案 |
| **暫存區** | 出貨暫存平台 | .git/index 檔案 | 準備下一次要提交的清單 |
| **物件 Blob, Tree, Commit** | 貨物、清單、棧板 | .git/objects 資料夾 | 儲存所有歷史資料，永久不變 |
| **參考 Branch, Tag** | 白板、標籤 | .git/refs 資料夾 | 用人類可讀的名稱指向特定 Commit |
| **HEAD** | 倉管員或您的位置 | .git/HEAD 檔案 | 指向您目前所在的那個分支 |

### 專案資料夾結構範例

這顯示了工作目錄和 .git 資料夾的相對位置。

```
/SuSuGiGi/ (您的專案根目錄，這就是「儲存庫」)
|
├── .git/ (Git 的管理中心，通常是隱藏的)
│   |
│   ├── HEAD         (檔案) -> 關鍵指標！指向您「目前」在哪個分支。
│   ├── config       (檔案) -> 儲存庫的設定檔 (例如遠端 origin 的網址)。
│   ├── index        (檔案) -> 「暫存區」(Staging Area) 本人。
│   │
│   ├── refs/        (資料夾) -> 存放「參考 (Refs)」的地方 (書籤/看板)
│   │   ├── heads/   (資料夾) -> 存放「分支 (Branches)」指標 (可移動的白板)
│   │   │   └── main   (檔案) -> 內容是 "f4c1e2..." (一個 Commit ID)
│   │   └── tags/    (資料夾) -> 存放「標籤 (Tags)」指標 (固定的標籤)
│   │       └── v1.0   (檔案) -> 內容是 "abc123..." (一個 Commit ID)
│   │
│   └── objects/     (資料夾) -> 核心！「物件資料庫」(所有貨物)
│       |
│       ├── f4/        (資料夾) -> 範例：存放 "f4c1e2..." 物件
│       │   └── c1e2...  (檔案) -> 一個「鬆散物件」(Loose Object)
│       ├── ab/
│       │   └── c123...  (檔案) ->  ...
```
---

### 進階 - 選讀：物件是如何被創造的？

當您理解了這些靜態零件後，可以進一步了解它們在 `git add` 與 `git commit` 這些動態操作中是如何被創造出來的。

#### `git add` 的內部動作

當您執行 `git add <檔案>` 時，Git 會執行兩個主要動作：

- **製作 Blob 物件 - 新貨物:**
    -   Git 讀取您指定檔案的完整內容。
    -   為這個內容計算出一個獨一無二的雜湊值 SHA-1 ID，例如 `9a3b...`。
    -   將新內容壓縮後，以這個雜湊值為名，建立一個 Blob 物件，並存入 .git/objects 儲藏區。
- **更新 Index - 更新出貨清單:**
    -   Git 更新 .git/index 這個出貨清單檔案。
    -   它在清單中記錄下檔名與剛剛建立的 Blob 物件 ID 的對應關係。

#### git commit 的內部動作

當您執行 `git commit` 時，Git 會根據暫存區 Index 的內容，進行一連串的打包作業：

- **製作 Tree 物件 - 最終貨物清單:**
    -   Git 掃描整個暫存區的清單，建立一個或多個 **Tree 物件**來代表專案當下的目錄結構。
- **製作 Commit 物件 - 新棧板:**
    -   Git 建立一個 **Commit 物件**，內容包含：
        -   **Tree ID：** 指向剛剛建立的根 Tree 物件 ID。
        -   **Parent ID：** 指向前一個 Commit 的 ID，將歷史串連起來。
        -   **作者/提交者資訊** 與 **提交訊息**。
- **移動分支指標 - 更新白板:**
    -   最後，Git 更新您目前所在分支的指標檔案，例如 .git/refs/heads/main，將其內容改為剛剛建立的新 Commit 物件的 ID。

---
