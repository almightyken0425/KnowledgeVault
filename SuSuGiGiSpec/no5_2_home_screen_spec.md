# 5.2. 首頁畫面 (HomeScreen)

_(本文件定義首頁的 UI 佈局、元件與互動邏輯 - 採用「可折疊面板」方案)_

## 1. 核心佈局

- **頂部 Header (固定):**
    
    - **位置:** 始終固定在螢幕頂部，不隨任何內容滾動而隱藏。
        
    - **內容:**
        
        - **App 名稱 (或 Logo):** 位於頂部中央 (例如 "速速記記")。
            
        - **左側按鈕區:** 包含 `帳戶篩選器` (點擊彈出帳戶列表) 和 `時間粒度篩選器` (點擊切換 日/週/月/年/全部)。
            
        - **右側按鈕區:** 包含 `設定入口按鈕` (例如齒輪圖標) 和一個 `(未來) 搜尋按鈕` 的預留位置。
            
- **主內容區 (View):**
    
    - **位置:** 位於頂部 Header 下方，佔據所有剩餘空間。
        
    - **結構:** 此區塊本身**不可**垂直滾動。它在內部垂直劃分為以下區域：
        
        - **1) 圓餅圖區塊 (PieChart):** 位於上方，預設可見，佔據一定初始高度。
            
        - **2) 總餘額 / 控制區塊:** 位於圖表下方，顯示總餘額，並包含「列表分組切換」按鈕。
            
        - **3) 逐筆紀錄區塊 (FlatList):** 位於最下方，佔據剩餘高度，此區域**內部可垂直滾動**。

- **底部 Footer (固定):**
    - **位置:** 固定在螢幕底部。
    - **內容:** 包含三個核心操作按鈕，由左至右排列：
        - **「新增收入」按鈕 (+):** 點擊導航至 `TransactionEditorScreen` (傳入 type=`income`)。
        - **「新增轉帳」按鈕 (→):** 點擊導航至 `TransferEditorScreen`。
        - **「新增支出」按鈕 (-):** 點擊導航至 `TransactionEditorScreen` (傳入 type=`expense`)。
    

## 2. 主內容區元件詳述

_(此區域的元件（2.1, 2.2, 2.3）會根據 3.1 的動畫互動進行高度調整)_

- **2.1 圓餅圖區塊:**
    
    - **圓餅圖 (甜甜圈圖):**
        
        - **數據:** 視覺化顯示**當前時間區間**內、**所選帳戶**的、按**標準支出類別** (`StandardCategoryId`) 聚合的支出分佈。
            
        - **中心:** 顯示換算為**基礎貨幣**的**總支出**金額。
        - **貨幣顯示邏輯:**
            - 若所有選定的帳戶都使用**相同的貨幣**，則總支出以該貨幣顯示。
            - 否則 (即選定的帳戶包含多種貨幣)，總支出將**換算為基礎貨幣**顯示。

    - **類別摘要 (可滾動):**
        
        - **UI:** 一個**水平滾動區域 (Horizontal ScrollView)**。
            
        - **數據:** 顯示**所有**在當前時間區間內有支出的標準類別（按金額或佔比降冪排列）。
            
        - **項目內容:** 顏色標示 (與圓餅圖對應)、類別名稱 (`defaultName`)、總金額或佔比。
            
        - **互動 (滾動):** 使用者可以左右滑動瀏覽所有類別。
            
        - **互動 (展開):** (可選) 末尾提供展開按鈕。
            
- **2.2 總餘額 / 控制區塊:**
    
    - **位置:** 位於 `2.1` 和 `2.3` 之間。
    
    - **內容 (總餘額):** 顯示當前時間區間內、所選帳戶的**總收入**、**總支出**、**總結餘**。
        - **貨幣顯示邏輯:**
            - 若所有選定的帳戶都使用**相同的貨幣**，則總餘額以該貨幣顯示。
            - 否則 (即選定的帳戶包含多種貨幣)，總餘額將**換算為基礎貨幣**顯示。

        - **計算註記:** 此處的「總收入」與「總支出」計算**必須包含** `Transfer` 記錄。若轉帳的轉出/轉入方在所選帳戶範圍內，應被視為支出/收入，以正確反映所選帳戶範圍的現金流變化。
        
    - **互動 (列表控制):** 包含**分組模式切換按鈕** (例如 `calendar` / `grid` 圖標)，允許使用者在「按日期分組」和「按類別分組」之間切換 `2.3` 區塊的顯示模式。

- **2.3 逐筆紀錄區塊 (FlatList):**
    
    - **UI:** 預設佔據螢幕下方一定高度，內部可垂直滾動。
        
    - **數據:** 顯示**當前時間區間**內、**所選帳戶**的交易紀錄 (`Transactions` 和 `Transfers`)，按 `TransactionDate` 降冪排列。
        
    - **顯示模式 (可切換):** 根據 `2.2` 中切換按鈕的狀態顯示：
        
        - **模式 A (按日期分組):** 預設模式，類似一般交易流水，可顯示日期分隔線。
            
        - **模式 B (按類別分組):** 將交易按 `StandardCategoryId` (或 `CategoryId`) 匯總，顯示各類別總金額，並可點擊展開查看該類別下的交易明細。
            
    - **顯示內容 (每筆交易):**
        
        - 圖標、類別名稱、(可選) 帳戶名稱、(可選) 備註、金額 (原始幣別)。
            
    - **互動 (點擊):**
        
        - **點擊單筆紀錄:** 導航至「編輯交易/轉帳」畫面 (`5.3`/`5.4`) (包含**管理**定期交易的入口)。


## 3. 核心互動

- **3.1 動畫互動 (折疊/展開):**
    
    - **向上滾動 (展開列表):** 當使用者在 `逐筆紀錄區塊` (2.3) 中向上滾動時，`圓餅圖區塊` (2.1) 動畫收合 (例如高度變為 0 或向上滑出螢幕)。`逐筆紀錄區塊` (2.3) 動畫展開以填滿空間 (`2.2 總餘額 / 控制區塊` 保持可見)。
        
    - **向下滾動 (恢復圖表):** 當使用者在 (已展開的) `逐筆紀錄區塊` (2.3) 中向下滾動至列表頂部 (scroll offset 0) 時，觸發反向動畫，`圓餅圖區塊` (2.1) 恢復顯示，`逐筆紀錄區塊` (2.3) 縮回原高度。
        
- **3.2 時間區間切換 (左右滑動手勢):**
    
    - **適用範圍:** `daily`, `weekly`, `monthly`, `yearly` 時間粒度 (由 Header 中按鈕設定)。
        
    - **行為:** 使用者在**「主內容區」** (包含 2.1, 2.2, 2.3 區域) **左右滑動**來切換到上一個/下一個時間區間。
        
    - **數據更新:** 此操作必須**同時**更新 (重新計算) `圓餅圖區塊` (2.1)、`總餘額 / 控制區塊` (2.2) 和 `逐筆紀錄區塊` (2.3) 的所有數據。
        
- **3.3 報表設定 (Header 互動):**
    
    - 使用者點擊 Header 中的「帳戶篩選器」來彈出多選列表。
    - **預設行為:** App 啟動時，帳戶篩選器**預設選取所有帳戶**。    
        
    - 使用者點擊 Header 中的「時間粒度篩選器」來切換時間粒度 (e.g., "Monthly")。    
    
    - **數據更新:** 選擇後，更新 `主內容區` (2.1, 2.2, 2.3) 的所有數據。

- **3.4 導航邏輯 (Navigation Logic):**
    - 當使用者點擊 Footer 中的「新增支出/收入/轉帳」按鈕時：
        - **如果**當前 `HomeScreen` 的時間粒度為 `daily`，則導航至 `TransactionEditorScreen` 或 `TransferEditorScreen` 時，需傳入當前報表日期作為 `defaultDate` 參數。
        - **否則**，正常導航，不傳遞日期參數。
